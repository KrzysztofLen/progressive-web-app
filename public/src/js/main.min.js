const shareImageButton=document.querySelector("#share-image-button"),createPostArea=document.querySelector("#create-post"),closeCreatePostModalButton=document.querySelector("#close-create-post-modal-btn"),pwaContactsList=document.querySelector("#pwa-contacts-list"),form=document.querySelector("form"),name=document.querySelector("#name"),email=document.querySelector("#email"),adress=document.querySelector("#adress"),bitcoin=document.querySelector("#bitcoin");let defferedPrompt="";const openCreatePostModal=()=>{createPostArea.style.transform="translateY(0)",defferedPrompt&&(defferedPrompt.prompt(),defferedPrompt.userChoice.then(e=>{console.log(e.outcome),"dismissed"===e.outcome?console.log("User cancelled installation"):console.log("User added to home screen")}),defferedPrompt=null),shareImageButton.style.display="none"};window.addEventListener("beforeinstallprompt",e=>(console.log("beforeinstallprompt fired"),e.preventDefault(),defferedPrompt=e,!1));const closeCreatePostModal=()=>{createPostArea.style.transform="translateY(100vh)",shareImageButton.style.display="block"},clearContact=()=>{for(;pwaContactsList.hasChildNodes();)pwaContactsList.removeChild(pwaContactsList.lastChild)},createContact=e=>{const t=document.createElement("div");t.className="demo-card-square mdl-card mdl-shadow--2dp";const a=document.createElement("div");a.className="mdl-card__title mdl-card--expand",t.appendChild(a);const o=document.createElement("span");o.className="mdl-list__item-primary-content",a.appendChild(o);const n=document.createElement("i");n.className="material-icons mdl-list__item-avatar",n.textContent="person",o.appendChild(n);const s=document.createElement("h4");s.className="pwa-card-name__name-header",s.textContent=e.name,o.appendChild(s);const c=document.createElement("div");c.className="mdl-card__supporting-text",t.appendChild(c);const r=[],l=[];for(let e=0;e<3;e++){const e=document.createElement("div");e.className="pwa-card-other-data-wrapper",c.appendChild(e);const t=document.createElement("span");t.className="pwa-card-label",e.appendChild(t);const a=document.createElement("span");a.className="mdl-list__item-sub-title",e.appendChild(a),l.push(a),r.push(t)}r[1].textContent="adress: ",r[2].textContent="bitcoin: ",r[0].textContent="email: ",l[0].textContent=e.email,l[1].textContent=e.adress,l[2].textContent=e.bitcoin;const d=document.createElement("div");d.className="pwa-card-other-data-wrapper",c.appendChild(d);const i=document.createElement("img");i.setAttribute("src",e.image),i.setAttribute("alt","xyz"),d.appendChild(i);const m=document.createElement("div");m.className="mdl-card__actions mdl-card--border",t.appendChild(m);const p=document.createElement("button");p.className="mdl-button mdl-js-button mdl-button--raised mdl-button--colored",p.textContent="View",m.appendChild(p),pwaContactsList.appendChild(t)};shareImageButton.addEventListener("click",()=>{createPostArea.style.transform="translateY(0)",defferedPrompt&&(defferedPrompt.prompt(),defferedPrompt.userChoice.then(e=>{console.log(e.outcome),"dismissed"===e.outcome?console.log("User cancelled installation"):console.log("User added to home screen")}),defferedPrompt=null),shareImageButton.style.display="none"}),closeCreatePostModalButton.addEventListener("click",closeCreatePostModal);const updateUI=e=>{clearContact();for(let t=0;t<e.length;t++)createContact(e[t])},url="https://pwa-app-72fbb.firebaseio.com/contacts.json";let networkDataReceived=!1;fetch(url).then(e=>e.json()).then(e=>{networkDataReceived=!0,console.log("From web",e);const t=[];for(const a in e)t.push(e[a]);updateUI(t)}),"indexedDB"in window&&getAllData("contacts").then(e=>{networkDataReceived||(console.log("From cache",e),updateUI(e))});const sendData=()=>{fetch("https://us-central1-pwa-app-72fbb.cloudfunctions.net/storeContactsData",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({id:(new Date).toISOString(),name:name.value,email:email.value,adress:adress.value,bitcoin:bitcoin.value,image:"https://firebasestorage.googleapis.com/v0/b/pwa-app-72fbb.appspot.com/o/brooke-lark-229136.jpg?alt=media&token=922238cc-7795-4316-ab1e-b32864c39f54"})}).then(e=>{console.log("Sent data",e),updateUI()})};form.addEventListener("submit",e=>{e.preventDefault(),""!==name.value.trim()&&""!==email.value.trim()&&""!==adress.value.trim()&&""!==bitcoin.value.trim()?(closeCreatePostModal(),"serviceWorker"in navigator&&"SyncManager"in window?navigator.serviceWorker.ready.then(e=>{const t={id:(new Date).toISOString(),name:name.value,email:email.value,adress:adress.value,bitcoin:bitcoin.value};setAllData("sync-contacts",t).then(()=>e.sync.register("sync-new-contact")).then(()=>{const e={message:"Your Post was saved for syncing!"};document.querySelector("#confirmation-toast").MaterialSnackbar.showSnackbar(e)}).catch(e=>{console.log(e)})}):sendData()):alert("Please enter valid data!")});